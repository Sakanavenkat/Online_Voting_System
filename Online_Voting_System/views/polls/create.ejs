<% const title = 'Create Poll' %>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <i class="fas fa-plus-circle fa-3x text-success mb-3"></i>
                    <h2 class="card-title">Create New Poll</h2>
                    <p class="text-muted">Gather opinions and make decisions together</p>
                </div>
                
                <form method="POST" action="/polls" id="pollForm">
                    <div class="mb-4">
                        <label for="title" class="form-label">
                            <i class="fas fa-heading me-2"></i>Poll Title *
                        </label>
                        <input type="text" class="form-control" id="title" name="title" required 
                               placeholder="What would you like to ask?">
                    </div>
                    
                    <div class="mb-4">
                        <label for="description" class="form-label">
                            <i class="fas fa-align-left me-2"></i>Description (Optional)
                        </label>
                        <textarea class="form-control" id="description" name="description" rows="3"
                                  placeholder="Provide more context for your poll..."></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="fas fa-list me-2"></i>Poll Options *
                        </label>
                        <div id="optionsContainer">
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" name="options" required 
                                       placeholder="Option 1">
                                <button type="button" class="btn btn-outline-danger" onclick="removeOption(this)" disabled>
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" name="options" required 
                                       placeholder="Option 2">
                                <button type="button" class="btn btn-outline-danger" onclick="removeOption(this)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-outline-primary" onclick="addOption()">
                            <i class="fas fa-plus me-2"></i>Add Option
                        </button>
                    </div>
                    
                    <div class="d-flex gap-3">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-plus me-2"></i>Create Poll
                        </button>
                        <a href="/polls" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
let optionCount = 2;

function addOption() {
    optionCount++;
    const container = document.getElementById('optionsContainer');
    const div = document.createElement('div');
    div.className = 'input-group mb-2';
    div.innerHTML = `
        <input type="text" class="form-control" name="options" required 
               placeholder="Option ${optionCount}">
        <button type="button" class="btn btn-outline-danger" onclick="removeOption(this)">
            <i class="fas fa-trash"></i>
        </button>
    `;
    container.appendChild(div);
}

function removeOption(button) {
    const container = document.getElementById('optionsContainer');
    const optionGroups = container.querySelectorAll('.input-group');
    
    if (optionGroups.length > 2) {
        button.parentElement.remove();
        updateOptionPlaceholders();
    }
    
    // Update remove button states
    updateRemoveButtons();
}

function updateOptionPlaceholders() {
    const inputs = document.querySelectorAll('#optionsContainer input[name="options"]');
    inputs.forEach((input, index) => {
        input.placeholder = `Option ${index + 1}`;
    });
}

function updateRemoveButtons() {
    const removeButtons = document.querySelectorAll('#optionsContainer .btn-outline-danger');
    const optionGroups = document.querySelectorAll('#optionsContainer .input-group');
    
    removeButtons.forEach((button, index) => {
        button.disabled = optionGroups.length <= 2;
    });
}

// Form validation
document.getElementById('pollForm').addEventListener('submit', function(e) {
    const options = document.querySelectorAll('input[name="options"]');
    const filledOptions = Array.from(options).filter(input => input.value.trim() !== '');
    
    if (filledOptions.length < 2) {
        e.preventDefault();
        alert('Please provide at least 2 options for your poll.');
        return false;
    }
});
</script>